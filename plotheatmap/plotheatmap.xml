<tool id="plotheatmap" name="plotHeatmap" version="1.0">
    <description>Plot heatmap</description>
    <requirements>
        <requirement type="package" version="3.0.1">r-gplots</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command>
        <![CDATA[ 
            $__tool_directory__/tools/script.R $main.count_matrix $main.stats_matrix $filter.log_fc $filter.log_cpm $filter.pvalue $filter.fdr $heatmap.cluster_row $heatmap.cluster_col $heatmap.hclust_method $plotparm.col_marg $plotparm.row_marg $plotparm.pdf_width $plotparm.pdf_height > $rscript_log 2> $rerror_log

        ]]>
    </command>
    <inputs>
        <section name="main" title="Main parameters" expanded="True">
            <param name="count_matrix" type="data" format="data" label="Output dataset 'count_matrix' from tool countMatrixForEdger"/>
            <param name="stats_matrix" type="data" format="data" label="Output dataset 'output' from tool edgeR"/>
        </section>
        <section name="filter" title="Filtering parameters" expanded="True">
            <param name="log_fc" type="float" value="0.5" label="A log FC threshold"/>
            <param name="log_cpm" type="float" value="0.5" label="A log CPM threshold"/>
            <param name="pvalue" type="float" value="0.5" label="A PValue threshold">
                <validator type="in_range" min="0" max="1" />
            </param>
            <param name="fdr" type="float" value="0.5" label="A FDR threshold">
                <validator type="in_range" min="0" max="1" />            
            </param>
        </section>
        <section name="heatmap" title="Heatmap parameters">
            <param name="cluster_row" type="select" label="Determines if the row dendrogram should be reordered">
                <option value="No" >No </option>
                <option value="Yes" selected="true" >Yes </option>
            </param>
            <param name="cluster_col" type="select" label="Determines if the column dendrogram should be reordered">
                <option value="No" selected="true">No </option>
                <option value="Yes" >Yes </option>
            </param>

            <param name="hclust_method" type="select" label="Hierarchical clustering method">
                <option value="ward.D" >ward.D </option>
                <option value="ward.D2" >ward.D2 </option>
                <option value="single" >single </option>
                <option value="complete" >complete </option>
                <option value="average" selected="true">average </option>
                <option value="mcquitty" >mcquitty </option>
                <option value="median" >median </option>
                <option value="centroid" >centroid </option>
            </param>
        </section>


       <section name="plotparm" title="Plot parameters">
            <param name="col_marg" type="float" value="7" label="Margins for column names"/>
            <param name="row_marg" type="float" value="8" label="Margins for row names"/>
            <param name="pdf_width" type="float" value="7" label="Width of the graphics region in inches (pdf width)" />
            <param name="pdf_height" type="float" value="7" label="Height of the graphics region in inches (pdf height)" />
        </section>

    </inputs>
    <outputs>
       <data format="pdf" name="haetamappdf" from_work_dir="heatmap.pdf" >
            <filter>(outftype == 'pdf')</filter>
        </data>
        <data name="rscript_log" format="data" />
        <data name="rerror_log" format="data" />
    </outputs>
    <tests>

        <test>
            <param name="count_matrix" value="count.matrix"/>
            <param name="stats_matrix" value="stats.data"/>
            <param name="log_fc" value="1"/>
            <param name="log_cpm" value="2"/>
            <param name="pvalue" value="0.05"/>
            <param name="fdr" value="0.1"/>
            <output name="haetamappdf" file="heatmap.pdf" ftype="pdf" compare="sim_size" />
            <output name="rscript_log" file="rscript.log"/>
            <output name="rerror_log" file="rerror.log"/>

        </test>

    </tests>
    <help>
        <![CDATA[ 
**What it does**
It takes a list of genes basen on set filtering criteria and draws them on heatmap.
**Example**
The following filtering options:
A log FC threshold = 0.5
A log CPM threshold = 0.5
A PValue threshold = 0.05
A FDR threshold = 0.1
mean that you select genes whose values in output table from edgeR are:
* absolute value of logFC is greater than or equal 0.5 
* logCPM is greater than or equal 0.5
* PValue is less than or equal to 0.05
* FDR is less than or equal to 0.1
     ]]>
    </help>
    <citations>
    </citations>
</tool>